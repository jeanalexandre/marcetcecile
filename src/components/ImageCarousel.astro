---
const { imgs, alt } = Astro.props;
---

<div class="relative w-full h-80 flex items-center justify-center overflow-hidden rounded-lg shadow-md"
     data-carousel-root>
  <img
      src={imgs[0]}
      alt={alt + ' (1/' + imgs.length + ')'}
      class="w-full h-80 object-cover transition-all duration-700"
      data-carousel-img
  />
  <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2">
    {imgs.map((_, i) => (
        <span
            key={i}
            class="block w-3 h-3 rounded-full bg-gray-300 cursor-pointer border"
            data-carousel-dot={i}
            aria-label={`Aller Ã  l'image ${i + 1}`}
        ></span>
    ))}
  </div>
  <script>
    // Island JS : slider infini simple
    const root = document.querySelector('[data-carousel-root]');
    if (!root) return;
    const img = root.querySelector('[data-carousel-img]');
    const dots = root.querySelectorAll('[data-carousel-dot]');
    const imgsArray = {JSON.stringify(imgs)};
    let idx = 0;
    function show(idxNow) {
      img.src = imgsArray[idxNow];
      img.alt = `${alt} (${idxNow+1}/${imgsArray.length})`;
      dots.forEach((dot, i) => {
        dot.classList.toggle('bg-[var(--color-secondary)]', i === idxNow);
        dot.classList.toggle('bg-gray-300', i !== idxNow);
      });
    }
    dots.forEach((dot, i) => {
      dot.addEventListener('click', () => {
        idx = i;
        show(idx);
      });
    });
    setInterval(() => {
      idx = (idx + 1) % imgsArray.length;
      show(idx);
    }, 3000);
    show(idx);
  </script>
</div>