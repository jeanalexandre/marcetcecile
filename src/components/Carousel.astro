---
const { images = [] } = Astro.props;
---
<div class="carousel my-6">
  <div class="carousel-track" id="carouselTrack" style="transform: translateX(0);">
    {images.map((img) => (
        <div class="carousel-slide card-elev">
          <img src={img.src} alt={img.alt} class="w-full h-44 object-cover" loading="lazy" />
          <div class="p-4"><p class="font-semibold">{img.caption}</p></div>
        </div>
    ))}
  </div>

  <div class="flex gap-2 mt-4 justify-center">
    <button id="prevBtn" class="px-3 py-1 border rounded">‹</button>
    <button id="nextBtn" class="px-3 py-1 border rounded">›</button>
  </div>
</div>

<script>
  (function(){
    const track = document.getElementById('carouselTrack');
    const prev = document.getElementById('prevBtn');
    const next = document.getElementById('nextBtn');
    if(!track) return;
    const update = (dir) => {
      const slideWidth = track.children[0].offsetWidth + 16;
      const maxIndex = Math.max(0, track.children.length - Math.floor(window.innerWidth / slideWidth));
      let current = Math.round(Math.abs(parseInt((track.style.transform.match(/-?\d+/) || [0])[0])) / slideWidth) || 0;
      let nextIndex = current + dir;
      if(nextIndex < 0) nextIndex = 0;
      if(nextIndex > maxIndex) nextIndex = maxIndex;
      track.style.transform = `translateX(${-nextIndex * slideWidth}px)`;
    };
    prev && prev.addEventListener('click', () => update(-1));
    next && next.addEventListener('click', () => update(1));
  })();
</script>
